---
layout: post
title: 单例模式（Singleton Pattern）
date: 2017-07-15 22:05
categories: 设计模式
tags: [设计模式,单例模式]
---

* content
{:toc}

# 小开端
关于单例模式其实我是没有准备这么早开始写的，不过确实是巧合，我这边刚好准备开始写单例模式，就遇到了一件和单例模式相关的小插曲，让我提前开始准备了单例模式的一些探讨，这个故事是这样的：  
> 今晚老大看我的项目框架，我在Demo里面写了一个关于Gson的单例，因为我们知道Gson没有提供静态方法，但是我们每次只是简单地把类转化为Json就要new一个Gson的实例，显然比较浪费，所以就写了一个单例，umm，我是这么写的

```java
public class GsonUtil {

	private static Gson gson = null;
	
	public Gson getGson () {
		if (gson == null) {
			gson = new Gson();
		}
		return gson;
	}
}
```
> 然后老大跟我说他也有一个Gson的单例模式，他是这样写的：

```java
public class Mygson {

	private static Gson instance = new GsonBuilder().setDateFormat("yyyy-MM-dd hh:mm:ss").create();
	
	public static Gson getInst() {
		return instance;
	}

}
```
> 然后老大说他的写法比较好，我的写法没有必要了，我愣了一下，难道单例模式也还有区别？

其实单例模式也是我接触地最多和最早的设计模式之一，而且我隐约记得单例模式还是无师自通的，因为应该是在哪一次项目中，觉得某个类到处new对象实在是太麻烦了，直觉到处new对象可能会造成资源的浪费，如果我可以new一个对象然后到处可以用就方便了，这就是我的单例模式的由来。  
关于我和老大的两种单例模式，我想了当时并没有反映过来，因为我的单例模式的写法用了很久，也没有深入去研究，我在回家的路上思考了一下，我关于这两种写法的想法初步是这样认为的：
- 老大的单例模式是在系统初始化的时候就构建了Gson的实例，然后每次调用都调用这个实例，那么会不会在系统初始化的时候因为某些原因构建失败导致实例为null，然后调用的时候整个系统每个调用的地方都会异常，导致系统有隐患？系统在使用的过程中如果出现了某些情况导致这个单例的实例被gc回收掉，那么单例无法重新创建，是不是也会造成隐患？因为这种单例的写法只构建一次Gson实例，**如果构建失败或者使用中被更改，那么这个实例不会再次被构建**。
- 我的单例的写法就没有上面的那个隐患，因为每次都会判断Gson实例是否存在，如果不存在就会重新new一个实例，但是，这样每次调用单例都会做一次判断，那么在大量**并发调用的时候会不会让系统的性能出现大幅度下降**？

基于这些疑问的存在，我对单例模式进行了一些研究。